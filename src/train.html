<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<script>
			var get_params = {}
			if(~location.href.indexOf('?')) {
				var pairs = location.href.split('#')[0].split('?')[1].split('&')
				for(var i = 0; i < pairs.length; i++) {
					var pair = pairs[i].split('=')
					get_params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1])
				}
			}

			var BASE_URL = ""
			var CONFIG_URL = BASE_URL + "config.xml"
			var LOCALE_URL = BASE_URL + "locale.xml"
			var NO_SHOW_TICKETS = "true"
			var SEATS_INFO_URL = escape("trs.xml")
			var SEAT_REQUEST = escape("trs.xml")
			var REGISTRATION_NUMBER = get_params.tourid

			var first = document.getElementsByTagName('script')[0]

			function add_script(src) {
				var elem   = document.createElement('script')
				elem.type  = 'text/javascript'
				elem.src   = BASE_URL + src
				first.parentNode.insertBefore(elem, first)
			}
			function add_style(obj) {
				var elem  = document.createElement('link')
				elem.rel  = 'stylesheet'
				elem.type = 'text/css'
				for(var name in obj) elem[name] = obj[name]
				elem.href = BASE_URL + obj.href
				first.parentNode.insertBefore(elem, first)
			}
			function all(arr, callback) {
				for(var i = 0; i < arr.length; i++) callback(arr[i])
			}

			var styles = {
				mobile: [
					{ href: 'css/common.css' },
					{ href: 'css/layout_small.css', media: 'screen and (max-width: 600px)' },
					{ href: 'css/layout_big.css',   media: 'screen and (min-width: 601px)' },
					{ href: 'css/left-to-right.css'}
				],
				flash: []
			}

			var scripts = {
				mobile: [
					'js/const.js',
                    'js/common.js'
				],
				flash: [
					'js/swfobject.js',
					'js/flash_main.js'
				]
			}

			try { var FLASH = new ActiveXObject('ShockwaveFlash.ShockwaveFlash').GetVariable('$version') } catch(e) {}
			try { var FLASH = navigator.plugins['Shockwave Flash'].description && navigator.mimeTypes['application/x-shockwave-flash'].enabledPlugin } catch(e) {}
            FLASH = FLASH && get_params.no_flash == null
            
			all(FLASH ? scripts.flash : scripts.mobile, add_script)
			all(FLASH ? styles.flash  : styles.mobile , add_style)
		</script>
	</head>
	<body style="display: none" data-bind="attr: { class: root_class }">
		<script type="text/html" id="user-select">
			<tr class="user" data-bind="click: $root.selectUser, css: { selected: selected, placed: curseat, infant: parent, disabled: disabled }">
				<!-- ko ifnot: parent || disabled -->
				<td class="info">
					<div class="name">
						<span data-bind="text: name" class="value"></span>
					</div>
					<table class="status" cellspacing=0 cellpadding=0>
						<tbody>
							<tr class="place">
								<td class="field">место: </td>
								<td data-bind="text: seat_name" class="value"></td>
							</tr>

							<tr class="car">
								<td class="field">вагон №: <span data-bind="text: id_car" class="value"></span></td>
								
							</tr>
							<tr class="sc">
								<td class="field">класс обслуживания: <span data-bind="text: fclass_name" class="value"></span></td>
								
							</tr>
							<tr class="class">
								<td class="field">класс: </td>
								<td data-bind="text: fclass" class="value"></td>
							</tr>
							<!-- ko if: message -->
							<tr class="message">
								<td data-bind="text: message"></td>
							</tr>
							<!-- /ko -->
						</tbody>
					</table>
				</td>
				<td class="print">
					<a target="_blank" data-bind="attr: { href: ticket }, css: { void: !ticket }">
						<div class="icon" data-bind="css: { 'static-print-a': selected, 'static-print-i': !selected() }"></div>
						<span class="label">Посадочный талон</span>
					</a>
				</td>
				<td class="class">
					<div class="label">класс: </div>
					<div data-bind="text: fclass" class="value"></div>
				</td>
				<td class="place">
					<div class="label">место: </div>
					<div data-bind="text: curseat" class="value"></div>
				</td>
				<td class="ok">
					<svg viewBox="0 0 18 18">
					<path d="M18,0l0,7l-11,11l-7,-7l0,-7l7,7l11,-11z" />
					</svg>
				</td>
				<!-- /ko -->
				<!-- ko if: parent -->
				<td colspan="3" class="info">
					<div class="name">
						<span data-bind="text: name" class="value"></span>
						<span style="text-transform: lowercase;"> вместе с </span>
						<span data-bind="text: parent.name" class="value"></span>
					</div>
				</td>
				<!-- /ko -->
				<!-- ko if: disabled -->
				<td colspan="3" class="info">
					<div class="name">
						<span data-bind="text: name" class="value"></span> <span data-bind="text: fclass" class="value"></span> <span data-bind="text: curseat" class="value"></span>
					</div>
					<div data-bind="text: disabled" class="reason"></div>
				</td>
				<!-- /ko -->
			</tr>
		</script>
		<script type="text/html" id="register-confirmation">
			<div class="register">
				<div data-bind="event: { tap: complete }" class="button-close static-button-close"></div>
				<div class="content">
					<div class="header">
						<div class="result" data-bind="text: result_header"></div>
						<div class="notice" data-bind="text: result_text"></div>
					</div>
					<div class="headers-wrap">
						<table class="list headers">
							<tbody>
								<tr>
									<td></td>
									<td>Место</td>
									<td>Посадочный талон</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div id="confirm-users" class="users-container static-background-gray">
						<table class="list users">
							<tbody data-bind="foreach: users">
								<tr class="user">
									<td data-bind="text: name" class="name"></td>
									<td data-bind="text: curseat" class="seat"></td>
									<td class="print">
										<a target="_blank" data-bind="attr: { href: ticket }, visible: ticket">
											<div class="icon static-print-i"></div>
											<span class="label">Распечатать</span>
										</a>
									</td>
								</tr>
								<!-- ko if: message || error -->
								<tr class="error">
									<td colspan="3" data-bind="text: message || error"></td>
								</tr>
								<!-- /ko -->
							</tbody>
						</table>
					</div>
					<div class="actions-wrap">
						<table class="actions">
							<tbody>
								<tr>
									<td>
										<div class="action button-change static-button-change" data-bind="event: { tap: complete }"></div>
									</td>
									<td>
										<a target="_blank"gclass="action button-print-all static-button-print-all" data-bind="attr: { href: group_ticket }, visible: group_ticket"></a>
									</td>
									<td>
										<div class="action button-complete static-button-complete" data-bind="event: { tap: complete }"></div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</script>
		<div data-bind="text: debug.pos_view" class="corner view-info"></div>
		<div class="logo static-biblioglobus_logo"></div>
		<div id="plane-scroll" class="view center">
			<div class="plane">
				<div class="fly">
					<div class="inner"></div>
					<div class="outer"></div>
				</div>
			</div>
			<div data-bind="event: { tap: hide_upper_deck }, css: lower_deck_class" class="button switch-deck one">Нижняя палуба</div>
			<div data-bind="event: { tap: show_upper_deck }, css: upper_deck_class" class="button switch-deck two">Верхняя палуба</div>
		</div>
        <table class="train_nav">
	        <thead>
	            <tr>
	            <td class="neighbors" data-bind="event: { tap: scroll_prev_to_car }"><div data-bind="text: prev_car_num">Предыдущий вагон №</div><div class="type" data-bind="text: prev_car_type"></div></td>
	            <td class="" data-bind="visible: prev_car_num">←</td>
	            <td class="current"><div  data-bind="text: current_car_num">Вагон №</div><div class="type" data-bind="text: current_car_type">купейный</div></td>
	            <td class="" data-bind="visible: next_car_num">→</td>
	            <td class="neighbors" data-bind="event: { tap: scroll_next_to_car }"><div  data-bind="text: next_car_num">Следующий вагон №</div><div class="type" data-bind="text: next_car_type"></div></td>
	            </tr>
	        </thead>
            <tr><td colspan="5">
            <div class="info">
	            <div class="descr">
	            	<div class="name">Описание: </div> <div class="text" data-bind="text: current_car_descr"></div>
	            </div>
	            <div class="carrier">
	            	<div class="name">Перевозчик: </div> <div class="text" data-bind="text: current_car_carrier"></div>
	            </div>
	            <div class="price">
	            	<div class="name">Цена: </div> <div class="text">от <span data-bind="text: current_car_prime_from"></span> руб <span data-bind='if: current_car_prime_to'> до <span data-bind='text: current_car_prime_to'></span> руб</span></div>
	            </div>
            </div> 

           </td></tr>
            
           
            
        </table>
		<div class="controls">
			<div class="screen">
				<div class="board-num">
					<div data-bind="text: board.name"     class="name" ></div>
					<div data-bind="text: board.boardnum" class="board"></div>
				</div>
				<div class="airline-logo-small"></div>
				<div class="nav">
					<div class="frame center"></div>
				</div>
				<div class="overlay"></div>
				<div data-bind="text: debug.pos_nav" class="corner nav-info"></div>
			</div>
			<div class="board-info-table">
				<table>
					<tbody>
						<tr>
							<td data-bind="text: board.boardnum" rowspan="2"></td>
							<td data-bind="text: formatAirport(board.from)"></td>
							<td data-bind="text: formatAirport(board.to)"></td>
						</tr>
						<tr>
							<td data-bind="text: board.time"></td>
							<td data-bind="text: board.date"></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="board-info">
				<div class="route">
					<span data-bind="text: formatAirport(board.from)" class="from"></span>
					<span> ― </span>
					<span data-bind="text: formatAirport(board.to)" class="to"></span>
				</div>
				<div class="cred clearfix">
					<div class="number">
						<span class="field">Рейс №: </span>
						<span data-bind="text: board.num" class="value big"></span>
					</div>
					<div class="date">
						<span class="field">Отбытие: </span>
						<span data-bind="text: board.time" class="value"></span>,
						<span data-bind="text: board.date" class="value"></span>
					</div>
				</div>
			</div>
			<div id="users-scroll" class="users-box static-user-bg">
				<table class="users" cellpadding=0>
					<tbody data-bind="template: { name: 'user-select', foreach: users }"></tbody>
				</table>
			</div>
			<div class="airline-logo"></div>
			<div data-bind="event: { tap: submit }, css: { disabled: !placedUsers().length || error_seat }" class="button confirm static-confirm">
				<div class="confirm-tick static-tick"></div>
				<div data-bind="text: confirm_caption" class="confirm-caption"></div>
			</div>
			<div data-bind="event: { tap: show_passengers }, css: { void:  passengers_visible() }" class="button confirm fill static-confirm">
				<div class="confirm-tick static-tick"></div>
				<div class="confirm-caption">Заполнить все места</div>
			</div>
			<div data-bind="event: { tap: hide_passengers }, css: { void: !passengers_visible() }" class="button confirm fill static-confirm">
				<div class="confirm-tick static-tick"></div>
				<div class="confirm-caption">Освободить все места</div>
			</div>
		</div>
		<a class="button back" href="demo/planes2.html"></a>
		<div class="popup done" data-bind="visible: display_result, template: 'register-confirmation'" style="display: none;"></div>
		<div class="popup fail" data-bind="visible: display_error" style="display: none;">
			<div class="register-error">
				<div class="message" data-bind="text: error_message"></div>
				<div class="close static-confirm" data-bind="event: { tap: hide_error }">ОК</div>
			</div>
		</div>
		<div data-bind="css: loading" class="background">
			<div class="center">
				<div class="sandglass static-sandglass"></div>
				<div class="caption">0%</div>
			</div>
		</div>
		<div class="popup group" data-bind='visible: show_popup_group()'>
			<div class="cont_group">
				<div class="title_cont_group">
					Создание групп
					<div class="close" data-bind='click: $root.popupGroup'>&times;</div>
				</div>
				<div class="list list_user">
					<div class="cont_list_user">
						<div class="title_path">Не выбранные пассажиры</div>
						<ul class="" data-bind='foreach: users'>
							<li class="itm_user" data-bind="visible: !d_check(), text: name, click:$root.clickUser" ></li>
						</ul>
					</div>
				</div>
				<div class="list list_group">
					<div class="cont_list_group">
						<div class="btn_create_group" data-bind='click: $root.addGroup'>Добавить группу +</div>
						<div class="cont_groups" data-bind='foreach: groups_users'>
							<div class="item_group" data-bind='css: { item: check}'>
								<div data-bind='text: name, click: $root.clickGroup.bind($data, "set", $index())' class='name_group'></div> 
								<div class="rem_group" data-bind='click :$root.clickGroup.bind($data,"rem", $index())'>Удалить -</div>
								<div class="list_g_user" data-bind='foreach: user'>
									<div class="g_user" data-bind='text:name, click:$root.clickUser' ></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
